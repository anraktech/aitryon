{% schema %}
{
  "name": "AI Try-On Product",
  "target": "section",
  "templates": ["product"],
  "stylesheet": "ai-tryon-combined.css",
  "javascript": "ai-tryon-combined.js",
  "settings": [
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "AI Changing Room"
    },
    {
      "type": "text",
      "id": "button_subtitle",
      "label": "Button Subtitle",
      "default": "See all products styled just for you"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#764ba2"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "label": "Button Roundness",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "select",
      "id": "button_font_family",
      "label": "Button Text Font",
      "default": "inherit",
      "options": [
        {
          "value": "inherit",
          "label": "Theme Default"
        },
        {
          "value": "var(--font-body-family)",
          "label": "Theme Body Font"
        },
        {
          "value": "var(--font-heading-family)",
          "label": "Theme Heading Font"
        },
        {
          "value": "'Helvetica Neue', Arial, sans-serif",
          "label": "Helvetica Neue"
        },
        {
          "value": "Inter, sans-serif",
          "label": "Inter"
        },
        {
          "value": "Poppins, sans-serif",
          "label": "Poppins"
        },
        {
          "value": "Roboto, sans-serif",
          "label": "Roboto"
        },
        {
          "value": "Montserrat, sans-serif",
          "label": "Montserrat"
        },
        {
          "value": "'Open Sans', sans-serif",
          "label": "Open Sans"
        },
        {
          "value": "Lato, sans-serif",
          "label": "Lato"
        },
        {
          "value": "'Source Sans Pro', sans-serif",
          "label": "Source Sans Pro"
        },
        {
          "value": "Arial, sans-serif",
          "label": "Arial"
        },
        {
          "value": "Georgia, serif",
          "label": "Georgia"
        },
        {
          "value": "'Times New Roman', serif",
          "label": "Times New Roman"
        },
        {
          "value": "'Courier New', monospace",
          "label": "Courier New"
        },
        {
          "value": "'Trebuchet MS', sans-serif",
          "label": "Trebuchet MS"
        },
        {
          "value": "Verdana, sans-serif",
          "label": "Verdana"
        }
      ]
    },
    {
      "type": "select",
      "id": "button_font_weight",
      "label": "Button Text Weight",
      "default": "normal",
      "options": [
        {
          "value": "normal",
          "label": "Normal"
        },
        {
          "value": "bold",
          "label": "Bold"
        },
        {
          "value": "lighter",
          "label": "Lighter"
        },
        {
          "value": "600",
          "label": "Semi Bold"
        }
      ]
    }
  ]
}
{% endschema %}

<!-- Combined Extension: Works on both Product Pages and Homepage -->

{% if request.page_type == 'product' %}
<!-- PRODUCT PAGE VERSION -->
<div class="ai-tryon-container"
  data-product-id="{{ product.id }}"
  data-product-image="{{ product.featured_image | image_url: 'master' }}"
>
  <button 
    class="ai-tryon-button ai-product-button" 
    id="ai-tryon-product-trigger"
    style="background-color: {{ block.settings.button_color }}; border-color: {{ block.settings.button_color }}; color: {{ block.settings.button_text_color }}; border-radius: {{ block.settings.button_border_radius }}px; font-family: {{ block.settings.button_font_family }}; font-weight: {{ block.settings.button_font_weight }};"
  >
    {{ block.settings.button_text | default: 'Try It On' }}
  </button>
</div>

<!-- Product Page Modal -->
<div id="ai-tryon-modal" class="ai-modal" style="display: none;">
  <div class="ai-modal-overlay"></div>
  <div class="ai-modal-content">
    <button class="ai-modal-close" aria-label="Close">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
    
    <div class="ai-modal-header">
      <h2 class="ai-modal-title">Virtual Try-On</h2>
      <p class="ai-modal-subtitle">Upload your photo for virtual try-on</p>
    </div>
    
    <div class="ai-modal-body">
      <!-- Upload State -->
      <div class="ai-upload-section" id="upload-section">
        <div class="ai-upload-options">
          <button class="ai-option-btn" id="upload-photo-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <span>Upload Photo</span>
          </button>
          
          <button class="ai-option-btn" id="use-camera-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            <span>Use Camera</span>
          </button>
        </div>
        
        <input type="file" id="photo-input" accept="image/*" style="display: none;">
        <input type="file" id="camera-input" accept="image/*" capture="camera" style="display: none;">
      </div>
      
      <!-- Preview State -->
      <div class="ai-preview-section" id="preview-section" style="display: none;">
        <div class="ai-images-preview">
          <div class="ai-image-preview">
            <img id="user-photo-preview" alt="Your photo">
          </div>
          <div class="ai-plus-icon">+</div>
          <div class="ai-image-preview">
            <img id="product-image-preview" alt="Product">
          </div>
        </div>
        
        <div class="ai-button-group">
          <button class="ai-change-photo" id="change-photo-btn">Change Photo</button>
          <button class="ai-generate-btn" id="generate-btn">
            <span class="ai-generate-text">Generate Try-On</span>
          </button>
        </div>
      </div>
      
      <!-- Loading State -->
      <div class="ai-loading-section" id="loading-section" style="display: none;">
        <div class="ai-loading-animation">
          <div class="ai-orbit-container">
            <div class="ai-orbit-item ai-orbit-user">
              <img id="loading-user-photo" alt="Your photo">
            </div>
            <div class="ai-orbit-item ai-orbit-product">
              <img id="loading-product-photo" alt="Product">
            </div>
          </div>
          <div class="ai-magic-center">✨</div>
        </div>
        <p class="ai-loading-text">Creating your perfect look...</p>
        <p class="ai-loading-subtext">This might take a minute or so - hang tight!</p>
        
        <!-- Fashion Facts Container -->
        <div id="loading-facts" class="ai-loading-facts">
          <div class="ai-facts-header">
            <span class="ai-facts-icon">✨</span>
            <h4 class="ai-facts-title">Did You Know?</h4>
          </div>
          <p class="ai-facts-text">Fashion facts will appear here...</p>
        </div>
      </div>
      
      <!-- Result State -->
      <div class="ai-result-section" id="result-section" style="display: none;">
        <div class="ai-result-message">
          <h3 class="ai-compliment" id="compliment-text">You look amazing!</h3>
        </div>
        
        <div class="ai-result-image-container">
          <img id="generated-image" alt="Generated try-on">
          <button class="ai-refresh-btn" id="refresh-to-default-btn" aria-label="Refresh to Default" title="Start Over">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <polyline points="1 20 1 14 7 14"/>
              <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
          </button>
        </div>
        
        <div class="ai-result-actions">
          <button class="ai-add-to-cart-btn" id="add-to-cart-btn">
            Add to Cart
          </button>
        </div>
      </div>
      
      <!-- Error State -->
      <div class="ai-error-section" id="error-section" style="display: none;">
        <div class="ai-error-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
        </div>
        <h3 class="ai-error-title" id="error-title">Oops!</h3>
        <p class="ai-error-message" id="error-message">Something went wrong. Please try again.</p>
        <button class="ai-retry-btn" id="retry-btn">Try Again</button>
      </div>
    </div>
    
    <div class="ai-modal-footer">
      <p class="ai-disclaimer">Use only your own photos | No nudity | AI-generated results may vary | Please refer to terms for more</p>
    </div>
  </div>
</div>


{% endif %}